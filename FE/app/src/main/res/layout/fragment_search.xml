<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools" android:id="@+id/main" android:layout_width="match_parent" android:layout_height="match_parent" android:background="@color/md_theme_light_background" android:orientation="vertical" tools:context=".ui.Activities.Fragment.Common.SearchFragment">

    <!-- Header Section with Green Rounded Background -->
    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:background="@drawable/bg_header_green_rounded" android:elevation="8dp" android:orientation="vertical" android:paddingStart="16dp" android:paddingTop="16dp" android:paddingEnd="16dp" android:paddingBottom="24dp">

        <!-- Back Button & Title -->
        <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="20dp" android:gravity="center_vertical" android:orientation="horizontal">

            <ImageButton android:id="@+id/backButton" android:layout_width="40dp" android:layout_height="40dp" android:background="@drawable/bg_button_white" android:contentDescription="@string/app_name" android:padding="10dp" android:scaleType="centerInside" android:src="@drawable/ic_back" app:tint="@color/app_green_primary" />

            <LinearLayout android:layout_width="0dp" android:layout_height="wrap_content" android:layout_marginStart="16dp" android:layout_weight="1" android:orientation="vertical">

                <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Tìm kiếm" android:textColor="@color/white" android:textSize="20sp" android:textStyle="bold" />

                <TextView android:id="@+id/viewMoreFilters" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginTop="2dp" android:alpha="0.9" android:text="cơ hội được tìm thấy" android:textColor="@color/white" android:textSize="13sp" />

            </LinearLayout>

        </LinearLayout>

        <!-- Search Bar with Filters -->
        <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:gravity="center_vertical" android:orientation="horizontal">

            <LinearLayout android:layout_width="0dp" android:layout_height="48dp" android:layout_marginEnd="12dp" android:layout_weight="1" android:background="@drawable/bg_search_bar" android:backgroundTint="@color/white" android:clickable="false" android:focusable="false" android:gravity="center_vertical" android:paddingHorizontal="12dp">

                <ImageView android:layout_width="20dp" android:layout_height="20dp" android:contentDescription="@string/app_name" android:src="@drawable/ic_search" app:tint="@color/gray_500" />

                <EditText android:id="@+id/searchKeyword" android:layout_width="match_parent" android:layout_height="match_parent" android:background="@null" android:enabled="true" android:focusable="true" android:focusableInTouchMode="true" android:hint="Tìm kiếm sự kiện, tổ chức..." android:imeOptions="actionSearch" android:importantForAutofill="no" android:inputType="text" android:maxLines="1" android:paddingStart="12dp" android:textColor="@color/text_primary" android:textColorHint="@color/gray_400" android:textSize="14sp" />

            </LinearLayout>

            <ImageButton android:id="@+id/filterButton" android:layout_width="48dp" android:layout_height="48dp" android:background="@drawable/bg_button_white" android:contentDescription="@string/app_name" android:padding="12dp" android:scaleType="centerInside" android:src="@drawable/ic_search" app:tint="@color/app_green_primary" />

        </LinearLayout>

    </LinearLayout>

    <!-- Content -->
    <androidx.core.widget.NestedScrollView android:layout_width="match_parent" android:layout_height="match_parent" android:fillViewport="true">

        <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="vertical" android:padding="16dp">

            <!-- Filter Panel -->
            <com.google.android.material.card.MaterialCardView android:id="@+id/filterPanel" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="20dp" android:visibility="gone" app:cardBackgroundColor="@android:color/white" app:cardCornerRadius="16dp" app:cardElevation="8dp" app:strokeColor="#E0E0E0" app:strokeWidth="2dp">

                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="vertical" android:padding="20dp">

                    <!-- Filter Header -->
                    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="20dp" android:gravity="center_vertical" android:orientation="horizontal">

                        <ImageView android:layout_width="20dp" android:layout_height="20dp" android:layout_marginEnd="12dp" android:contentDescription="@string/app_name" android:scaleType="centerInside" android:src="@drawable/ic_filter" app:tint="@color/app_green_primary" />

                        <TextView android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:text="Bộ lọc" android:textColor="@color/text_primary" android:textSize="16sp" android:textStyle="bold" />

                        <TextView android:id="@+id/clearFiltersBtn" android:layout_width="wrap_content" android:layout_height="wrap_content" android:padding="4dp" android:text="Xóa tất cả" android:textColor="@color/app_green_primary" android:textSize="13sp" android:textStyle="bold" />

                    </LinearLayout>

                    <!-- Category Filter - RecyclerView Horizontal -->
                    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="20dp" android:orientation="vertical">

                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginBottom="12dp" android:text="Danh mục" android:textColor="@color/text_primary" android:textSize="14sp" android:textStyle="bold" />

                        <androidx.recyclerview.widget.RecyclerView android:id="@+id/categoryFiltersRecyclerView" android:layout_width="match_parent" android:layout_height="wrap_content" android:clipToPadding="false" android:orientation="horizontal" android:scrollbars="none" app:layoutManager="androidx.recyclerview.widget.LinearLayoutManager" />

                        <!-- CheckBoxes for category filters -->
                        <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginTop="12dp" android:gravity="center_vertical" android:orientation="horizontal">

                            <CheckBox android:id="@+id/categoryEnvironment" android:layout_width="wrap_content" android:layout_height="wrap_content" android:buttonTint="@color/app_green_primary" android:text="Môi trường" android:textSize="14sp" />

                            <CheckBox android:id="@+id/categoryEducation" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginStart="16dp" android:buttonTint="@color/app_green_primary" android:text="Giáo dục" android:textSize="14sp" />

                            <CheckBox android:id="@+id/categoryHealth" android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginStart="16dp" android:buttonTint="@color/app_green_primary" android:text="Y tế" android:textSize="14sp" />

                        </LinearLayout>

                    </LinearLayout>

                    <!-- Divider -->
                    <View android:layout_width="match_parent" android:layout_height="1dp" android:layout_marginBottom="20dp" android:background="#F0F0F0" />

                    <!-- Date Range Filter -->
                    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="24dp" android:orientation="vertical">

                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:layout_marginBottom="12dp" android:text="Hạn đăng ký" android:textColor="@color/text_primary" android:textSize="14sp" android:textStyle="bold" />

                        <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:gravity="center_vertical" android:orientation="horizontal">

                            <LinearLayout android:layout_width="0dp" android:layout_height="48dp" android:layout_marginEnd="8dp" android:layout_weight="1" android:background="@drawable/bg_search_bar" android:backgroundTint="#F5F5F5" android:gravity="center_vertical" android:paddingHorizontal="12dp">

                                <ImageView android:layout_width="20dp" android:layout_height="20dp" android:layout_marginEnd="8dp" android:src="@drawable/ic_calendar" app:tint="@color/gray_500" />

                                <EditText android:id="@+id/startDate" android:layout_width="match_parent" android:layout_height="match_parent" android:background="@null" android:hint="Từ ngày" android:inputType="date" android:textColor="@color/text_primary" android:textColorHint="@color/gray_400" android:textSize="13sp" />

                            </LinearLayout>

                            <LinearLayout android:layout_width="0dp" android:layout_height="48dp" android:layout_marginStart="8dp" android:layout_weight="1" android:background="@drawable/bg_search_bar" android:backgroundTint="#F5F5F5" android:gravity="center_vertical" android:paddingHorizontal="12dp">

                                <ImageView android:layout_width="20dp" android:layout_height="20dp" android:layout_marginEnd="8dp" android:src="@drawable/ic_calendar" app:tint="@color/gray_500" />

                                <EditText android:id="@+id/endDate" android:layout_width="match_parent" android:layout_height="match_parent" android:background="@null" android:hint="Đến ngày" android:inputType="date" android:textColor="@color/text_primary" android:textColorHint="@color/gray_400" android:textSize="13sp" />

                            </LinearLayout>

                        </LinearLayout>

                    </LinearLayout>

                    <!-- Action Buttons -->
                    <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:gravity="center" android:orientation="horizontal">

                        <androidx.appcompat.widget.AppCompatButton android:id="@+id/resetFilterBtn" style="?android:attr/borderlessButtonStyle" android:layout_width="0dp" android:layout_height="48dp" android:layout_marginEnd="8dp" android:layout_weight="1" android:background="@drawable/bg_search_bar" android:backgroundTint="@color/white" android:text="Đặt lại" android:textAllCaps="false" android:textColor="@color/app_green_primary" android:textSize="14sp" android:textStyle="bold" />

                        <androidx.appcompat.widget.AppCompatButton android:id="@+id/applyFilterBtn" android:layout_width="0dp" android:layout_height="48dp" android:layout_marginStart="8dp" android:layout_weight="1" android:background="@drawable/bg_button_base" android:backgroundTint="@color/button_blue" android:text="Áp dụng" android:textAllCaps="false" android:textColor="@color/white" android:textSize="14sp" android:textStyle="bold" />

                    </LinearLayout>

                </LinearLayout>

            </com.google.android.material.card.MaterialCardView>

            <!-- AI Explanation Card - Only visible for AI search -->
            <com.google.android.material.card.MaterialCardView android:id="@+id/aiExplanationCard" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="16dp" android:visibility="gone" app:cardBackgroundColor="#E8F5E9" app:cardCornerRadius="16dp" app:cardElevation="4dp" app:strokeColor="@color/app_green_primary" app:strokeWidth="1dp">

                <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:orientation="horizontal" android:padding="16dp">

                    <ImageView android:layout_width="32dp" android:layout_height="32dp" android:layout_marginEnd="12dp" android:src="@drawable/ic_star" app:tint="@color/app_green_primary" />

                    <LinearLayout android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:orientation="vertical">

                        <TextView android:layout_width="wrap_content" android:layout_height="wrap_content" android:text="Gợi ý từ AI" android:textColor="@color/app_green_primary" android:textSize="13sp" android:textStyle="bold" />

                        <TextView android:id="@+id/tvAiExplanation" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginTop="6dp" android:lineSpacingExtra="4dp" android:text="AI sẽ giải thích tại sao gợi ý các sự kiện này..." android:textColor="@color/text_primary" android:textSize="14sp" />
                    </LinearLayout>
                </LinearLayout>
            </com.google.android.material.card.MaterialCardView>

            <!-- Results Label -->
            <LinearLayout android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="16dp" android:gravity="center_vertical" android:orientation="horizontal">

                <TextView android:layout_width="0dp" android:layout_height="wrap_content" android:layout_weight="1" android:text="Kết quả" android:textColor="@color/text_primary" android:textSize="16sp" android:textStyle="bold" />

                <Spinner android:id="@+id/sortSpinner" android:layout_width="wrap_content" android:layout_height="wrap_content" android:background="@drawable/bg_search_bar" android:backgroundTint="@color/white" android:entries="@array/sort_options" android:padding="8dp" />

            </LinearLayout>

            <!-- Search Results RecyclerView -->
            <androidx.recyclerview.widget.RecyclerView android:id="@+id/searchResultsRecyclerView" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="16dp" android:orientation="vertical" app:layoutManager="androidx.recyclerview.widget.LinearLayoutManager" />

            <!-- No Results Message -->
            <LinearLayout android:id="@+id/noResultsContainer" android:layout_width="match_parent" android:layout_height="wrap_content" android:gravity="center" android:orientation="vertical" android:padding="40dp" android:visibility="gone">

                <ImageView android:layout_width="100dp" android:layout_height="100dp" android:layout_marginBottom="16dp" android:contentDescription="@string/app_name" android:scaleType="centerInside" android:src="@drawable/ic_search" app:tint="@color/gray_300" />

                <TextView android:id="@+id/noResultsMessage" android:layout_width="match_parent" android:layout_height="wrap_content" android:layout_marginBottom="8dp" android:gravity="center" android:text="Không tìm thấy kết quả nào" android:textColor="@color/text_secondary" android:textSize="16sp" android:textStyle="bold" />

                <TextView android:layout_width="match_parent" android:layout_height="wrap_content" android:gravity="center" android:text="Hãy thử tìm kiếm với từ khóa khác hoặc điều chỉnh bộ lọc" android:textColor="@color/text_secondary" android:textSize="14sp" />

            </LinearLayout>

        </LinearLayout>

    </androidx.core.widget.NestedScrollView>

</LinearLayout>
